<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Account - Mark Sumo Bot</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f3f4f6;min-height:100vh;display:flex;flex-direction:column}
nav{display:flex;align-items:center;padding:0 32px;height:60px;background:#fff;border-bottom:1px solid #e5e7eb}
.nav-logo span{background:linear-gradient(135deg,#f97316,#facc15);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800;font-size:18px}
main{flex:1;display:flex;align-items:center;justify-content:center;padding:24px}
.card{background:#fff;border-radius:16px;padding:40px;width:100%;max-width:440px;box-shadow:0 4px 24px rgba(0,0,0,.07);border:1px solid #e5e7eb}
.icon{width:56px;height:56px;background:#fff7ed;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:26px;margin:0 auto 20px}
h1{font-size:22px;font-weight:700;text-align:center;margin-bottom:6px}
.sub{font-size:14px;color:#6b7280;text-align:center;margin-bottom:28px}
.form-group{margin-bottom:14px}
label{display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:6px}
input{width:100%;padding:11px 14px;border:1.5px solid #e5e7eb;border-radius:8px;font-size:14px;outline:none;transition:.2s;color:#111}
input:focus{border-color:#f97316;box-shadow:0 0 0 3px rgba(249,115,22,.1)}
.hint{font-size:12px;color:#9ca3af;margin-top:4px}
.btn{width:100%;padding:12px;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;border:none;margin-top:8px;transition:.2s}
.btn-primary{background:linear-gradient(135deg,#f97316,#ea580c);color:#fff}
.btn-primary:hover{opacity:.9}
.btn-primary:disabled{opacity:.6;cursor:not-allowed}
.links{text-align:center;margin-top:20px;font-size:13px;color:#6b7280}
.links a{color:#f97316;text-decoration:none;font-weight:600}
.error{background:#fef2f2;border:1px solid #fecaca;color:#dc2626;border-radius:8px;padding:10px 14px;font-size:13px;margin-bottom:16px;display:none}
</style>
</head>
<body>
<nav><div class="nav-logo"><a href="/" style="text-decoration:none"><span>Mark Sumo Bot</span></a></div></nav>
<main>
  <div class="card">
    <div class="icon">ðŸ‘¤</div>
    <h1>Create Account</h1>
    <p class="sub">Join Mark Sumo Bot and start deploying bots</p>
    <div class="error" id="error"></div>
    <form id="form">
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="username" placeholder="e.g. markuser" required>
        <div class="hint">Only lowercase letters, numbers, and underscores allowed</div>
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="email" placeholder="e.g. user@gmail.com" required>
      </div>
      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="name" placeholder="e.g. Mark Sumo" required>
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="password" placeholder="Create a password" required>
        <div class="hint">Must be at least 6 characters</div>
      </div>
      <div class="form-group">
        <label>Confirm Password</label>
        <input type="password" id="confirm" placeholder="Confirm your password" required>
      </div>
      <button type="submit" class="btn btn-primary" id="btn">Create Account</button>
    </form>
    <div class="links">
      Already have an account? <a href="/login">Sign in</a>
    </div>
  </div>
</main>

<script>
  if (localStorage.getItem('msb_token')) window.location.href = '/dashboard';

  document.getElementById('form').onsubmit = async (e) => {
    e.preventDefault();
    const btn = document.getElementById('btn');
    const err = document.getElementById('error');
    err.style.display = 'none';

    const password = document.getElementById('password').value;
    const confirm  = document.getElementById('confirm').value;
    if (password !== confirm) {
      err.textContent = 'Passwords do not match.';
      err.style.display = 'block';
      return;
    }

    btn.disabled = true;
    btn.textContent = 'Creating account...';

    try {
      const res = await fetch('/api/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('username').value.trim().toLowerCase(),
          email:    document.getElementById('email').value.trim(),
          name:     document.getElementById('name').value.trim(),
          password
        })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error);
      localStorage.setItem('msb_token', data.token);
      localStorage.setItem('msb_user', JSON.stringify(data.user));
      window.location.href = '/dashboard';
    } catch (e) {
      err.textContent = e.message;
      err.style.display = 'block';
      btn.disabled = false;
      btn.textContent = 'Create Account';
    }
  };
</script>
</body>
</html>
